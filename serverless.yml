service: micro-bots

frameworkVersion: '2'

provider:
  name: aws
  runtime: nodejs12.x
  region: eu-central-1
  stage: production
  environment:
    MOCO_TOKEN: ${env:MOCO_TOKEN}
    SLACK_TOKEN: ${env:SLACK_TOKEN}
    WORKLOAD_CHANNEL: ${env:WORKLOAD_CHANNEL}
    EMPLOYEE_NAMES: ${env:EMPLOYEE_NAMES}
    COMPLETION_NOTICE_CHANNEL: ${env:COMPLETION_NOTICE_CHANNEL}
    WORKLOAD_PERCENTAGE: ${env:WORKLOAD_PERCENTAGE}

plugins:
  - serverless-webpack

custom:
  webpack:
    includeModules: true

functions:
  birthday:
    handler: src/functions/birthday.handler
    memorySize: 128
    timeout: 10
    environment:
      LEAD_TIME: 21
    events:
      - schedule:
          rate: cron(5 4 * * ? *)
          enabled: true
  completionNotice:
    handler: src/functions/completion-notice.handler
    memorySize: 128
    timeout: 15
    events:
      - http:
          path: completionNotice
          method: post
  lockProject:
    handler: src/functions/lock-project.handler
    memorySize: 128
    events:
      - http:
          path: lockProject
          method: post
  mailSignature:
    handler: src/functions/mail-signature.handler
    memorySize: 128
    events:
      - http:
          path: mailSignature
          method: post
  unlockProject:
    handler: src/functions/unlock-project.handler
    memorySize: 128
    events:
      - http:
          path: unlockProject
          method: post
  workload:
    handler: src/functions/workload.handler
    memorySize: 128
    events:
      - http:
          path: workload
          method: post
  workloadAll:
    handler: src/functions/workload-all.handler
    memorySize: 128
    events:
      - http:
          path: workloadAll
          method: post
      - schedule:
          rate: cron(0 16 ? * FRI *)
          enabled: true
